---
- name: gather variables for each operating system
  include_vars: "{{ item }}"
  with_first_found:
  - "_{{ ansible_hostname }}.yml"
  - "{{ ansible_architecture | lower }}/{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}.yml"
  - "{{ ansible_architecture | lower }}/{{ ansible_distribution | lower }}.yml"
  - "{{ ansible_architecture | lower }}/{{ ansible_os_family | lower }}.yml"
  - "{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}.yml"
  - "{{ ansible_distribution | lower }}.yml"
  - "{{ ansible_os_family | lower }}.yml"
  tags: [ always ]

- include: item.yml
  with_dict:
  - "{{ selfsigned_cert_fqdn }}"
  when: selfsigned_cert_fqdn | type_debug == 'dict'
  tags: [ reconfigure ]

- name: put gossfile
  template:
    src: goss.yml.j2
    dest: "{{ goss_dir }}/selfsigned-cert.yml"
    owner: root
    group: root
    mode: '0600'
  when: goss_dir is defined
  tags: [ reconfigure ]
